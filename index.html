<!doctype html>
<html lang="ko">
<head>
<meta charset="utf-8" />
<title>3D íƒœì–‘ê³„ â€” AU ë‹¨ìœ„</title>
<meta name="viewport" content="width=device-width,initial-scale=1" />
<style>
html,body{height:100%;margin:0;background:#061024;color:#e9f2ff;font:12px/1.4 system-ui}
#app{position:fixed; inset:0}
canvas{display:block; width:100%; height:100%}
.ui{
  position:fixed; left:12px; top:12px; background:rgba(255,255,255,.04);
  border:1px solid rgba(255,255,255,.06); padding:8px 10px; border-radius:10px;
  display:flex; gap:10px; flex-wrap:wrap; align-items:center; max-width:96vw; z-index:20;
}
.row{display:flex; gap:8px; align-items:center; flex-wrap:wrap}
.btn{cursor:pointer; padding:4px 8px; border-radius:8px; border:1px solid rgba(255,255,255,.12); background:rgba(255,255,255,.02)}
.btn:hover{background:rgba(255,255,255,.04)}
input[type="range"]{width:200px}
select,input[type="number"]{background:transparent; color:#e9f2ff; border:1px solid rgba(255,255,255,.06); border-radius:6px; padding:4px}
.hint{opacity:.7;font-size:12px;color:#bcd}
</style>
</head>
<body>
<div id="app"></div>

<div class="ui">
  <div class="row">
    <label for="speed">ì†ë„</label>
    <input id="speed" type="range" min="0" max="8" step="0.1" value="2">
    <input id="speedNum" type="number" min="0" max="8" step="0.1" value="2" style="width:60px">
    <button class="btn" data-rate="1">1Ã—</button>
    <button class="btn" data-rate="2">2Ã—</button>
    <button class="btn" data-rate="3">3Ã—</button>
  </div>

  <div class="row">
    <label for="focusSel">ì¤‘ì‹¬ì </label>
    <select id="focusSel">
      <option>ììœ (ìˆ˜ë™)</option>
      <option>íƒœì–‘</option>
      <option selected>ì§€êµ¬</option>
      <option>ìˆ˜ì„±</option><option>ê¸ˆì„±</option><option>ë‹¬</option><option>í™”ì„±</option>
      <option>ëª©ì„±</option><option>í† ì„±</option><option>ì²œì™•ì„±</option><option>í•´ì™•ì„±</option><option>ëª…ì™•ì„±</option>
    </select>
    <label><input id="axisToggle" type="checkbox" checked> ìì „ì¶• í‘œì‹œ</label>
    <span class="hint">â€¢ ì¢Œí´ë¦­: íšŒì „ Â· íœ : ì¤Œ Â· ìš°í´ë¦­: íŒ¬(ììœ  ëª¨ë“œ)</span>
  </div>

  <div class="row">
    <button class="btn" id="spawnAsteroidBtn">â˜„ï¸ ì†Œí–‰ì„± ì†Œí™˜ (ì•)</button>
    <button class="btn" id="spawnShipBtn">ğŸš€ ìš°ì£¼ì„  ì†Œí™˜ (ì•)</button>
    <button class="btn" id="clearShipsBtn">ğŸ—‘ï¸ ìš°ì£¼ì„  ì‚­ì œ</button>
    <label style="margin-left:8px"><input id="showGravity" type="checkbox" checked> ì¤‘ë ¥ê¶Œ ì‹œê°í™”</label>
  </div>
</div>

<script src="https://unpkg.com/three@0.155.0/build/three.min.js"></script>

<script>
// ---------- ê¸°ë³¸ ë Œë”ëŸ¬/ì”¬/ì¹´ë©”ë¼ ----------
const app = document.getElementById('app');
const renderer = new THREE.WebGLRenderer({ antialias: true });
renderer.setPixelRatio(Math.min(devicePixelRatio, 2));
renderer.setSize(app.clientWidth, app.clientHeight);
renderer.setClearColor(0x061024, 1);
app.appendChild(renderer.domElement);

const scene = new THREE.Scene();
const camera = new THREE.PerspectiveCamera(60, app.clientWidth/app.clientHeight, 0.0001, 1000); // AU ë‹¨ìœ„

let radius = 5, phi = THREE.MathUtils.degToRad(25), theta = THREE.MathUtils.degToRad(30);
const manualTarget = new THREE.Vector3(0,0,0);
let focusTarget = null;
function getTarget(){ return focusTarget ? focusTarget.getWorldPosition(new THREE.Vector3()) : manualTarget; }
function updateCam(){
  const t = getTarget();
  const x = t.x + radius * Math.sin(phi) * Math.cos(theta);
  const y = t.y + radius * Math.cos(phi);
  const z = t.z + radius * Math.sin(phi) * Math.sin(theta);
  camera.position.set(x,y,z);
  camera.lookAt(t);
}
updateCam();

scene.add(new THREE.AmbientLight(0xffffff, 0.35));
const sunLight = new THREE.PointLight(0xffffff, 2.6, 0, 2);
scene.add(sunLight);

// ---------- helpers ----------
function axisMesh(len, thick=0.006){
  const g = new THREE.CylinderGeometry(thick, thick, len, 12);
  const m = new THREE.MeshBasicMaterial({ color:0xffffff, transparent:true, opacity:0.7, depthWrite:false });
  const cyl = new THREE.Mesh(g, m);
  cyl.position.y = 0;
  return cyl;
}

// containers
const bodies = {};
const axisList = [];

let timeScale = 2; // days/sec

// ---------- Sun ----------
const sun = new THREE.Mesh(
  new THREE.SphereGeometry(0.1, 64, 64),
  new THREE.MeshStandardMaterial({ color: 0xffd97a, emissive:0xffaa44 })
);
scene.add(sun);
sunLight.position.copy(sun.position);

// ---------- createBody ----------
function createBodySimple({ name, size=0.01, color=0xffffff, axialTiltDeg=0 } = {}) {
  const group = new THREE.Group();
  const mat = new THREE.MeshStandardMaterial({ color, roughness: 0.7 });
  const sphere = new THREE.Mesh(new THREE.SphereGeometry(size, 32,32), mat);
  group.add(sphere);
  const ax = axisMesh(size*3.0, Math.max(0.003, size*0.06));
  group.add(ax); axisList.push(ax);
  return { name, group, sphere, axis: ax, size };
}

// ---------- planet data (AU ë‹¨ìœ„) ----------
const planetDefs = [
  { name:'ìˆ˜ì„±', size:0.003, color:0xb4b4b4, a:0.39, e:0.2056409, rotH:58.6462, tilt:0.01, orbit:87.97, inclination:7 },
  { name:'ê¸ˆì„±', size:0.008, color:0xd8b47d, a:0.72, e:0.0067, rotH:-243.025, tilt:177.36, orbit:224.7, inclination:3.39 },
  { name:'ì§€êµ¬', size:0.01, color:0x5fa8ff, a:1.0, e:0.0167, rotH:0.997, tilt:23.44, orbit:365.256, inclination:0,
    moons:[ { name:'ë‹¬', color:0xcfd6ff, size:0.0027, a:0.00257, orbit:27.322, rotH:655.7, tilt:6.68 } ]
  },
  { name:'í™”ì„±', size:0.005, color:0xff6b6b, a:1.524, e:0.0934, rotH:1.025, tilt:25.19, orbit:686.98, inclination:1.85,
    moons:[ { name:'í¬ë³´ìŠ¤', color:0xaaaaaa, size:0.0012, a:0.0000628, orbit:0.3189, rotH:7.65, tilt:0 },
            { name:'ë°ì´ëª¨ìŠ¤', color:0xcccccc, size:0.0008, a:0.000157, orbit:1.263, rotH:30.3, tilt:0 } ]
  },
  { name:'ëª©ì„±', size:0.1, color:0xc89f68, a:5.204, e:0.0489, rotH:0.414, tilt:3.13, orbit:4332.589, inclination:1.3,
    moons:[ { name:'ì´ì˜¤', color:0xe6d27c, size:0.0025, a:0.0028, orbit:1.769, rotH:42.46, tilt:0 },
            { name:'ìœ ë¡œíŒŒ', color:0xdddddd, size:0.0022, a:0.0045, orbit:3.551, rotH:85.2, tilt:0.1 } ]
  },
  { name:'í† ì„±', size:0.09, color:0xd8cfae, a:9.582, e:0.0565, rotH:0.444, tilt:26.73, orbit:10759.22, inclination:2.49, ring:true,
    moons:[ { name:'íƒ€ì´íƒ„', color:0xcab47a, size:0.0028, a:0.008, orbit:15.945, rotH:382.7, tilt:0.3 } ]
  },
  { name:'ì²œì™•ì„±', size:0.04, color:0x9bd7ff, a:19.201, e:0.0457, rotH:-0.718, tilt:97.77, orbit:30688.5, inclination:0.77,
    moons:[ { name:'í‹°íƒ€ë‹ˆì•„', color:0xcccccc, size:0.0018, a:0.006, orbit:8.706, rotH:208.9, tilt:0 } ]
  },
  { name:'í•´ì™•ì„±', size:0.038, color:0x6aa7ff, a:30.047, e:0.0113, rotH:0.67, tilt:28.32, orbit:60182.0, inclination:1.77,
    moons:[ { name:'íŠ¸ë¦¬í†¤', color:0xcfd6ff, size:0.0022, a:0.0065, orbit:5.877, rotH:141.0, tilt:0, retrogradeOrbit:true } ]
  },
  { name:'ëª…ì™•ì„±', size:0.018, color:0x999999, a:39.482, e:0.2488, rotH:6.387, tilt:122.53, orbit:90560.0, inclination:17.16,
    moons:[ { name:'ì¹´ë¡ ', color:0xcccccc, size:0.005, a:0.002, orbit:6.387, rotH:153.3, tilt:0 } ]
  }
];

// ---------- create planet states ----------
const planetStates = [];
for(const def of planetDefs){
  const b = def.a * Math.sqrt(1 - (def.e||0)**2);
  const curve = new THREE.EllipseCurve( - (def.e||0)*def.a, 0, def.a, b, 0, 2*Math.PI, false, 0 );
  const points = curve.getPoints(256);
  const orbitGeometry = new THREE.BufferGeometry().setFromPoints(points.map(p=>new THREE.Vector3(p.x,0,p.y)));
  const orbitMaterial = new THREE.LineBasicMaterial({ color:def.color, transparent:true, opacity:0.35 });
  const orbitLine = new THREE.LineLoop(orbitGeometry, orbitMaterial);
  scene.add(orbitLine);

  const body = createBodySimple({ name:def.name, size:def.size, color:def.color, axialTiltDeg:def.tilt });
  scene.add(body.group);

  if(def.ring){
    const ringGeom = new THREE.RingGeometry(def.size*2, def.size*2.8, 128);
    ringGeom.rotateX(-Math.PI/2);
    const ringMat = new THREE.MeshStandardMaterial({ color:0xd8cfae, roughness:0.9, transparent:true, opacity:0.7, side:THREE.DoubleSide });
    const ring = new THREE.Mesh(ringGeom, ringMat);
    body.group.add(ring);
  }

  const moons = [];
  if(def.moons){
    for(const m of def.moons){
      const mBody = createBodySimple({ name:m.name, size:m.size, color:m.color, axialTiltDeg:m.tilt });
      body.group.add(mBody.group);
      moons.push({ def:m, node:mBody, orbitAngle:0 });
    }
  }

  const pstate = { def, node:body, moons, a:def.a, b, e:def.e||0, orbitLine, orbitAngle:Math.random()*Math.PI*2, rotPeriodHours:def.rotH, _destroyed:false };
  planetStates.push(pstate);
  bodies[def.name] = body.group;
}

// ---------- tick ----------
let last = performance.now();
function tick(now){
  const dtSec = (now-last)/1000; last=now;
  const dtDays = dtSec * timeScale;

  // íƒœì–‘ íšŒì „
  sun.rotation.y += dtDays * (2*Math.PI / 25.0); // ìš”ì²­í•œ ê°’ ì ìš© ê°€ëŠ¥

  for(const ps of planetStates){
    if(ps._destroyed){ ps.orbitAngle += dtDays*(2*Math.PI/ps.def.orbit); continue; }
    ps.orbitAngle += dtDays*(2*Math.PI/ps.def.orbit);
    const ang = ps.orbitAngle, a = ps.a, b = ps.b, e = ps.e;
    const x = a*(Math.cos(ang)-e), z = b*Math.sin(ang);
    ps.node.group.position.set(x,0,z);

    if(ps.node.group.children[0]) ps.node.group.children[0].rotation.y += dtDays*(2*Math.PI/Math.abs(ps.rotPeriodHours/24));

    for(let i=0;i<ps.moons.length;i++){
      const m = ps.moons[i]; m.orbitAngle += dtDays*(2*Math.PI/m.def.orbit);
      const mx = Math.cos(m.orbitAngle)*m.def.a, mz = -Math.sin(m.orbitAngle)*m.def.a;
      m.node.group.position.set(mx,0,mz);
    }
  }

  renderer.render(scene,camera);
  requestAnimationFrame(tick);
}
requestAnimationFrame(tick);

// ---------- camera controls ----------
addEventListener('resize',()=>{ camera.aspect = app.clientWidth/app.clientHeight; camera.updateProjectionMatrix(); renderer.setSize(app.clientWidth,app.clientHeight); });
</script>
</body>
</html>
